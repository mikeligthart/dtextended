package Individual;

sub add_to_loop {
  my ($spc,$t,$s,$seen) = @_;
  my @n = (4, 2, (5+(8+7)*(8+2)), 4, 4);
  @n = map $_ % $nn, @n;
  if (!$seen->{fof}++) {
  my $l = zeroes($t);

  if ('tune') {
    my $sound = q[combine(asynth(2, $n[$note % @n], $len, $spc, [3, 0.7123, 0.9605, 3*(5+4), 0.9007, 6, 6, 1, -(4/3), 1/2], [8, 0.3057, 0.1733, 0, 0.6036, 2, 1, 3, -(4/4)*(1/4), 1/4],  mseries([1, 0.3239, 0.3861, 0, 0.302, ((8+6)+8*3), 7, 3, -(1/2), 4], 5, 7, 0.9928)),asynth(0.25, $n[$note % @n], $len, $spc, [3, 0.797, 0.01913, 0, 0.7892, 3*(5*6+2*5)*4, 5, 5, 6, 1/3], [7, 0.9315, 0.8529, 8*8*1*4, 0.8735, 6, (3+5), 8, -(1/4), 3],  mseries([8, 0.5563, 0.7708, 7*7, 0.6027, 4*8, 5, 1, (3+2), 4], 6, 1, 0.6728), [5, 0.4226, 0.706, 0, 0.4796, (8+(7+8)), 8, 1, -(4/2), 1], [4, 0.06165, 0.3349, 0, 0.301, 2, 6, 5, -(4/3), 1],  mseries([9, 0.277, 0.2577, 0, 0.7028, (8+6), 1, 3, -(1/1), 2], 3, 1, 0.4015)),0.1+0.09+0.04+0.02+0.14)];
    my ($note, $param, $len) = ((2+(((7+2)+(1+6))+(((2*3+1)+7)+8*(5+1))*7)),(5+8*1),nlen(4*(3/2)*(4/3)));
    my ($vol, $pan, $groove, $phase) = (0.02+0.15+0.02+0.1+0.04,0.9885,-7,0);
    my ($lowrad, $lowcyc, $hirad, $hicyc) = (8,3*6,4,7*1);
    my $remain=$l->nelem/5;
my $rest;
foreach(1..5){
 foreach my $ref([3, nlen(4*(4/3)), 0], [7*2, nlen(4*(4/3)), 0], [5*4, nlen(4*(4/3)), 0]){
  ($note,$len,$rest) = @$ref;
  $l->dice(X,[0],[0],[0]) .= pdl([getsound(eval '"'.$sound.'"'),$vol,$pan,$groove,$phase]);
  $l=offset($l,-int($len+$rest));
  $remain-=$len+$rest;
 }
 last if($remain<0);
}
$l = offset($l,2*4*4+1*4+1);
  }

  addlayer($s, $l, $spc);
  }
}
